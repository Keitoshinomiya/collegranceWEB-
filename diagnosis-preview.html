<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Scent Quiz Preview - COLLEGRANCE</title>
    <!-- Fonts & CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Noto+Sans+JP:wght@300;400;500&family=Zen+Kaku+Gothic+Antique:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css">
    <style>
        /* Preview Specific Styles */
        body { background-color: #f9f9f9; }
        .preview-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 40px;
            background: #fff;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border-radius: 12px;
            text-align: center;
        }
        .preview-header { margin-bottom: 30px; }
        .preview-header h1 { font-family: 'Zen Kaku Gothic Antique', sans-serif; font-weight: 500; letter-spacing: 0.05em; }
        
        /* Advanced Quiz Styles */
        .quiz-wrapper {
            position: relative;
            min-height: 400px;
            overflow: hidden;
        }
        
        .quiz-step-container {
            transition: all 0.4s ease;
        }
        
        .quiz-question-title {
            font-size: 1.4rem;
            margin-bottom: 1.5rem;
            color: #333;
            font-family: 'Zen Kaku Gothic Antique', sans-serif;
        }
        
        .quiz-options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .quiz-option-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 120px;
        }
        
        .quiz-option-card:hover {
            border-color: #333;
            background: #fcfcfc;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .quiz-option-icon {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
        }
        
        .quiz-option-text {
            font-size: 1rem;
            color: #333;
            font-weight: 500;
        }
        
        .quiz-option-sub {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }

        /* Progress Bar */
        .quiz-progress {
            width: 100%;
            height: 4px;
            background: #eee;
            margin-bottom: 30px;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .quiz-progress-bar {
            height: 100%;
            background: #333;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Result View */
        .quiz-result-view {
            text-align: center;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .result-match-rate {
            display: inline-block;
            background: #333;
            color: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 15px;
            font-family: 'Courier Prime', monospace;
        }

        .result-product-card {
            background: #fff;
            border: 1px solid #eee;
            padding: 30px;
            max-width: 500px;
            margin: 0 auto 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }
        
        .result-img-wrapper {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            overflow: hidden;
        }
        
        .result-img-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            /* Filter similar to site style */
            filter: sepia(10%) grayscale(10%) contrast(95%);
        }
        
        .result-brand {
            font-family: 'Courier Prime', monospace;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .result-name {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            margin-bottom: 15px;
            line-height: 1.2;
        }
        
        .result-desc {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #555;
            margin-bottom: 20px;
            text-align: left;
        }
        
        .result-notes {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            border-top: 1px solid #eee;
            padding-top: 15px;
            margin-bottom: 25px;
        }
        
        .note-item span:first-child {
            display: block;
            font-size: 0.7rem;
            color: #999;
            margin-bottom: 3px;
        }
        
        .note-item span:last-child {
            font-size: 0.85rem;
            font-weight: 500;
        }

        .btn-restart {
            background: transparent;
            border: 1px solid #ccc;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .btn-restart:hover {
            border-color: #333;
            color: #333;
        }

        /* Loading Animation */
        .analyzing-view {
            display: none;
            padding: 50px 0;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #eee;
            border-top: 3px solid #333;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Mobile Optimization */
        @media (max-width: 600px) {
            .quiz-options-grid { grid-template-columns: 1fr; }
            .quiz-option-card { height: auto; padding: 15px; flex-direction: row; justify-content: flex-start; text-align: left; }
            .quiz-option-icon { margin-bottom: 0; margin-right: 15px; }
            .preview-container { padding: 20px; margin: 20px 10px; }
        }
    </style>
</head>
<body>

    <nav class="navbar" style="position:relative; background:#fff; box-shadow:none; border-bottom:1px solid #eee;">
        <div class="container">
            <div class="nav-brand" style="margin:0 auto;">
                <a href="index.html">
                    <img src="assets/images/logo.png" alt="COLLEGRANCE" class="logo-image">
                </a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="preview-container">
            <div class="preview-header">
                <h1>AI Scent Diagnostic Preview</h1>
                <p>ã‚ˆã‚Šãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸæ–°ã—ã„é¦™æ°´è¨ºæ–­æ©Ÿèƒ½ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã§ã™ã€‚<br>ãŠå®¢æ§˜ã®å›ç­”ã«åŸºã¥ãã€æœ€é©ãªä¸€æœ¬ã‚’ç‹¬è‡ªã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§å°ãå‡ºã—ã¾ã™ã€‚</p>
            </div>

            <div class="quiz-wrapper" id="quizWrapper">
                <!-- Progress Bar -->
                <div class="quiz-progress">
                    <div class="quiz-progress-bar" id="progressBar"></div>
                </div>

                <!-- Step 1 -->
                <div class="quiz-step-container" id="step1">
                    <h2 class="quiz-question-title">Q1. é¦™æ°´ã‚’ä¸»ã«ä½¿ã„ãŸã„ã‚·ãƒ¼ãƒ³ã¯ï¼Ÿ</h2>
                    <div class="quiz-options-grid">
                        <div class="quiz-option-card" onclick="nextStep(1, 'scene', 'office')">
                            <span class="quiz-option-icon">ğŸ¢</span>
                            <div>
                                <div class="quiz-option-text">ã‚ªãƒ•ã‚£ã‚¹ãƒ»ä»•äº‹</div>
                                <div class="quiz-option-sub">æ¸…æ½”æ„Ÿã¨ä¿¡é ¼æ„Ÿã‚’å¤§åˆ‡ã«ã—ãŸã„</div>
                            </div>
                        </div>
                        <div class="quiz-option-card" onclick="nextStep(1, 'scene', 'date')">
                            <span class="quiz-option-icon">ğŸ·</span>
                            <div>
                                <div class="quiz-option-text">ãƒ‡ãƒ¼ãƒˆãƒ»ãƒ‡ã‚£ãƒŠãƒ¼</div>
                                <div class="quiz-option-sub">é­…åŠ›ã‚’å¼•ãå‡ºã—ã€å°è±¡ã«æ®‹ã—ãŸã„</div>
                            </div>
                        </div>
                        <div class="quiz-option-card" onclick="nextStep(1, 'scene', 'relax')">
                            <span class="quiz-option-icon">â˜•</span>
                            <div>
                                <div class="quiz-option-text">ä¼‘æ—¥ãƒ»ãƒªãƒ©ãƒƒã‚¯ã‚¹</div>
                                <div class="quiz-option-sub">è‡ªåˆ†ã®ãŸã‚ã«é¦™ã‚Šã‚’æ¥½ã—ã¿ãŸã„</div>
                            </div>
                        </div>
                        <div class="quiz-option-card" onclick="nextStep(1, 'scene', 'daily')">
                            <span class="quiz-option-icon">ğŸ‘Ÿ</span>
                            <div>
                                <div class="quiz-option-text">æ—¥å¸¸ãƒ»ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«</div>
                                <div class="quiz-option-sub">ã©ã‚“ãªæœè£…ã«ã‚‚åˆã†ä¸‡èƒ½ãªé¦™ã‚Š</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="quiz-step-container" id="step2" style="display:none;">
                    <h2 class="quiz-question-title">Q2. å¥½ã¿ã®é¦™ã‚Šã®ç³»çµ±ã¯ï¼Ÿ</h2>
                    <div class="quiz-options-grid">
                        <div class="quiz-option-card" onclick="nextStep(2, 'scent_type', 'citrus')">
                            <span class="quiz-option-icon">ğŸ‹</span>
                            <div>
                                <div class="quiz-option-text">ã‚·ãƒˆãƒ©ã‚¹ãƒ»ã‚µãƒœãƒ³</div>
                                <div class="quiz-option-sub">çˆ½ã‚„ã‹ã§æ¸…æ½”æ„Ÿã®ã‚ã‚‹é¦™ã‚Š</div>
                            </div>
                        </div>
                        <div class="quiz-option-card" onclick="nextStep(2, 'scent_type', 'floral')">
                            <span class="quiz-option-icon">ğŸ’</span>
                            <div>
                                <div class="quiz-option-text">ãƒ•ãƒ­ãƒ¼ãƒ©ãƒ«ãƒ»ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£</div>
                                <div class="quiz-option-sub">è¯ã‚„ã‹ã§ç”˜ç¾ãªé¦™ã‚Š</div>
                            </div>
                        </div>
                        <div class="quiz-option-card" onclick="nextStep(2, 'scent_type', 'woody')">
                            <span class="quiz-option-icon">ğŸŒ²</span>
                            <div>
                                <div class="quiz-option-text">ã‚¦ãƒƒãƒ‡ã‚£ãƒ»ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼</div>
                                <div class="quiz-option-sub">è½ã¡ç€ã„ãŸå¤§äººã®é¦™ã‚Š</div>
                            </div>
                        </div>
                        <div class="quiz-option-card" onclick="nextStep(2, 'scent_type', 'musk')">
                            <span class="quiz-option-icon">â˜ï¸</span>
                            <div>
                                <div class="quiz-option-text">ãƒ ã‚¹ã‚¯ãƒ»ã‚¹ã‚­ãƒ³</div>
                                <div class="quiz-option-sub">è‚Œã«é¦´æŸ“ã‚€æŸ”ã‚‰ã‹ã„é¦™ã‚Š</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="quiz-step-container" id="step3" style="display:none;">
                    <h2 class="quiz-question-title">Q3. ç›¸æ‰‹ã«ä¸ãˆãŸã„å°è±¡ã¯ï¼Ÿ</h2>
                    <div class="quiz-options-grid">
                        <div class="quiz-option-card" onclick="nextStep(3, 'impression', 'clean')">
                            <span class="quiz-option-icon">âœ¨</span>
                            <div>
                                <div class="quiz-option-text">æ¸…æ½”æ„Ÿãƒ»ãƒ”ãƒ¥ã‚¢</div>
                                <div class="quiz-option-sub">èª°ã‹ã‚‰ã‚‚å¥½ã‹ã‚Œã‚‹é€æ˜æ„Ÿ</div>
                            </div>
                        </div>
                        <div class="quiz-option-card" onclick="nextStep(3, 'impression', 'sophisticated')">
                            <span class="quiz-option-icon">ğŸ•¶ï¸</span>
                            <div>
                                <div class="quiz-option-text">çŸ¥çš„ãƒ»æ´—ç·´</div>
                                <div class="quiz-option-sub">éƒ½ä¼šçš„ã§ã‚¹ãƒãƒ¼ãƒˆãªé›°å›²æ°—</div>
                            </div>
                        </div>
                        <div class="quiz-option-card" onclick="nextStep(3, 'impression', 'friendly')">
                            <span class="quiz-option-icon">ğŸ˜Š</span>
                            <div>
                                <div class="quiz-option-text">è¦ªã—ã¿ã‚„ã™ã•ãƒ»æ˜ã‚‹ã•</div>
                                <div class="quiz-option-sub">è©±ã—ã‹ã‘ã‚„ã™ã„æŸ”ã‚‰ã‹ãªç©ºæ°—</div>
                            </div>
                        </div>
                        <div class="quiz-option-card" onclick="nextStep(3, 'impression', 'sensual')">
                            <span class="quiz-option-icon">ğŸ’‹</span>
                            <div>
                                <div class="quiz-option-text">è‰²æ°—ãƒ»ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹</div>
                                <div class="quiz-option-sub">è¨˜æ†¶ã«æ®‹ã‚‹æ·±ã¿ã®ã‚ã‚‹å°è±¡</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4 -->
                <div class="quiz-step-container" id="step4" style="display:none;">
                    <h2 class="quiz-question-title">Q4. é¦™ã‚Šã®å¼·ã•ã®å¥½ã¿ã¯ï¼Ÿ</h2>
                    <div class="quiz-options-grid">
                        <div class="quiz-option-card" onclick="finishQuiz('strength', 'light')">
                            <span class="quiz-option-icon">ğŸƒ</span>
                            <div>
                                <div class="quiz-option-text">ã•ã‚Šã’ãªãé¦™ã‚‹</div>
                                <div class="quiz-option-sub">è‡ªåˆ†ã ã‘ãŒæ°—ã¥ãç¨‹åº¦</div>
                            </div>
                        </div>
                        <div class="quiz-option-card" onclick="finishQuiz('strength', 'medium')">
                            <span class="quiz-option-icon">ğŸ‘Œ</span>
                            <div>
                                <div class="quiz-option-text">ç¨‹ã‚ˆãé¦™ã‚‹</div>
                                <div class="quiz-option-sub">ã™ã‚Œé•ã„ã–ã¾ã«ãµã‚ã£ã¨</div>
                            </div>
                        </div>
                        <div class="quiz-option-card" onclick="finishQuiz('strength', 'heavy')">
                            <span class="quiz-option-icon">ğŸ’</span>
                            <div>
                                <div class="quiz-option-text">ã—ã£ã‹ã‚Šé¦™ã‚‹</div>
                                <div class="quiz-option-sub">é•·æ™‚é–“æŒç¶šã•ã›ãŸã„</div>
                            </div>
                        </div>
                        <div class="quiz-option-card" onclick="finishQuiz('strength', 'unique')">
                            <span class="quiz-option-icon">ğŸ¨</span>
                            <div>
                                <div class="quiz-option-text">å€‹æ€§é‡è¦–</div>
                                <div class="quiz-option-sub">äººã¨è¢«ã‚‰ãªã„ç‹¬ç‰¹ãªé¦™ã‚Š</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analyzing View -->
                <div class="analyzing-view" id="analyzingView">
                    <div class="spinner"></div>
                    <h3>AIãŒç›¸æ€§ã‚’åˆ†æä¸­...</h3>
                    <p style="color:#888;">ã‚ãªãŸã®å¥½ã¿ã‚’é¦™ã‚Šã®æˆåˆ†ãƒ‡ãƒ¼ã‚¿ã¨ç…§åˆã—ã¦ã„ã¾ã™</p>
                </div>

                <!-- Result View -->
                <div class="quiz-result-view" id="resultView">
                    <span class="result-match-rate">MATCH RATE: 98%</span>
                    
                    <div class="result-product-card">
                        <div class="result-brand" id="resBrand">BRAND NAME</div>
                        <h2 class="result-name" id="resName">Perfume Name</h2>
                        <div class="result-img-wrapper">
                            <img src="" alt="Result" id="resImg">
                        </div>
                        
                        <div class="result-notes">
                            <div class="note-item">
                                <span>TOP NOTE</span>
                                <span id="resTop">Citrus</span>
                            </div>
                            <div class="note-item">
                                <span>MIDDLE NOTE</span>
                                <span id="resMid">Floral</span>
                            </div>
                            <div class="note-item">
                                <span>BASE NOTE</span>
                                <span id="resBase">Musk</span>
                            </div>
                        </div>
                        
                        <p class="result-desc" id="resDesc">
                            å•†å“èª¬æ˜ãŒã“ã“ã«å…¥ã‚Šã¾ã™ã€‚
                        </p>
                        
                        <a href="#" class="btn-primary" id="resLink" style="display:block; text-align:center;">å•†å“è©³ç´°ã‚’è¦‹ã‚‹</a>
                    </div>
                    
                    <button class="btn-restart" onclick="restartQuiz()">ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
                    
                    <div style="margin-top:30px; border-top:1px solid #eee; padding-top:20px;">
                        <h4 style="font-size:0.9rem; color:#666; margin-bottom:15px;">ã“ã¡ã‚‰ã‚‚ãŠã™ã™ã‚ï¼ˆMatch Rate: 92%ï¼‰</h4>
                        <div id="secondRecommendation" style="display:flex; gap:10px; justify-content:center; align-items:center; text-align:left; max-width:400px; margin:0 auto; padding:10px; background:#fff; border:1px solid #eee; border-radius:8px; cursor:pointer;" onclick="">
                            <img src="" id="secImg" style="width:50px; height:50px; object-fit:contain;">
                            <div>
                                <div id="secBrand" style="font-size:0.7rem; color:#999;">BRAND</div>
                                <div id="secName" style="font-weight:bold; font-size:0.9rem;">Name</div>
                            </div>
                            <div style="margin-left:auto; color:#333;">&rarr;</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- Enhanced Product Database with Scoring Tags ---
        const products = [
            // Citrus / Fresh / Clean
            { 
                id: 'ck_one', 
                brand: 'Calvin Klein', 
                name: 'ck one', 
                img: 'assets/images/CK-One-EDT.jpg',
                top: 'Bergamot', mid: 'Green Tea', base: 'Musk',
                desc: 'ä¸–ç•Œä¸­ã§æ„›ã•ã‚Œã‚‹ãƒ¦ãƒ‹ã‚»ãƒƒã‚¯ã‚¹ãƒ•ãƒ¬ã‚°ãƒ©ãƒ³ã‚¹ã®é‡‘å­—å¡”ã€‚ãƒ”ãƒ¥ã‚¢ã§æ¸…æ½”æ„Ÿã®ã‚ã‚‹é¦™ã‚Šã¯ã€ã‚ªãƒ•ã‚£ã‚¹ã‹ã‚‰ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã¾ã§ã‚ã‚‰ã‚†ã‚‹ã‚·ãƒ¼ãƒ³ã«é¦´æŸ“ã¿ã¾ã™ã€‚',
                link: 'index.html#products',
                tags: { scene: ['office', 'daily', 'relax'], type: ['citrus', 'clean'], impression: ['clean', 'friendly'], strength: ['light', 'medium'] }
            },
            { 
                id: 'light_blue', 
                brand: 'Dolce & Gabbana', 
                name: 'Light Blue', 
                img: 'assets/images/DG-LightBlue-EDT.jpg',
                top: 'Sicilian Lemon', mid: 'Apple', base: 'Cedarwood',
                desc: 'åœ°ä¸­æµ·ã®é™½å…‰ã‚’æ€ã‚ã›ã‚‹ã€ã¨ã³ãã‚Šãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãªã‚·ãƒˆãƒ©ã‚¹ã€‚æ°—åˆ†ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã•ã›ãŸã„æ™‚ã‚„ã€å¤ã®æ—¥ã®ã‚¹ã‚¿ã‚¤ãƒ«ã«å®Œç’§ã«ãƒãƒƒãƒã—ã¾ã™ã€‚',
                link: 'index.html#products',
                tags: { scene: ['daily', 'relax', 'office'], type: ['citrus', 'fruity'], impression: ['friendly', 'clean'], strength: ['light', 'medium'] }
            },
            { 
                id: 'blanche', 
                brand: 'BYREDO', 
                name: 'Blanche', 
                img: 'assets/images/BYR-Blanche-EDP.jpg',
                top: 'White Rose', mid: 'Neroli', base: 'Musk',
                desc: 'ã€Œç™½ã€ã¨ã„ã†è‰²ã‚’é¦™ã‚Šã§è¡¨ç¾ã—ãŸã€ç©¶æ¥µã®æ¸…æ½”æ„Ÿã€‚æ´—ã„ãŸã¦ã®ãƒªãƒãƒ³ã‚„çŸ³é¹¸ã‚’æ€ã‚ã›ã‚‹é¦™ã‚Šã¯ã€èª°ã‹ã‚‰ã‚‚å¥½å°è±¡ã‚’æŒãŸã‚Œã‚‹é­”æ³•ã®ä¸€æœ¬ã€‚',
                link: 'index.html#products',
                tags: { scene: ['office', 'daily', 'date'], type: ['clean', 'floral'], impression: ['clean', 'sophisticated'], strength: ['medium', 'light'] }
            },
            
            // Floral / Fruity / Sweet
            { 
                id: 'english_pear', 
                brand: 'Jo Malone London', 
                name: 'English Pear & Freesia', 
                img: 'assets/images/JML-EnglishPear-C.jpg',
                top: 'King William Pear', mid: 'Freesia', base: 'Patchouli',
                desc: 'ç†Ÿã—ãŸæ´‹æ¢¨ã®ç‘ã€…ã—ã•ã¨ã€ç™½ã„ãƒ•ãƒªãƒ¼ã‚¸ã‚¢ã®ãƒ–ãƒ¼ã‚±ã€‚è‹±å›½ã®æœæ¨¹åœ’ã«ã„ã‚‹ã‚ˆã†ãªã€å„ªé›…ã§æ„›ã‚‰ã—ã„é¦™ã‚Šã€‚å¥½æ„Ÿåº¦No.1ã®ãƒ™ã‚¹ãƒˆã‚»ãƒ©ãƒ¼ã€‚',
                link: 'index.html#products',
                tags: { scene: ['daily', 'date', 'office'], type: ['floral', 'fruity'], impression: ['friendly', 'clean'], strength: ['light', 'medium'] }
            },
            { 
                id: 'rose_gold', 
                brand: 'TIFFANY & CO.', 
                name: 'Rose Gold', 
                img: 'assets/images/TFFY-RoseGold-EDP.jpg',
                top: 'Blackcurrant', mid: 'Blue Rose', base: 'Ambrette',
                desc: 'ãƒ†ã‚£ãƒ•ã‚¡ãƒ‹ãƒ¼ã‚‰ã—ã„é€æ˜æ„Ÿã¨ã€ãƒ­ãƒ¼ã‚ºã‚´ãƒ¼ãƒ«ãƒ‰ã®æ¸©ã‹ã¿ã‚’è¡¨ç¾ã€‚ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãªãƒˆãƒƒãƒ—ã‹ã‚‰ä¸Šå“ãªãƒ­ãƒ¼ã‚ºã¸ç§»ã‚ã†ã€å¥³æ€§ã‚‰ã—ã•ã‚’é«˜ã‚ã‚‹é¦™ã‚Šã€‚',
                link: 'index.html#products',
                tags: { scene: ['date', 'office', 'special'], type: ['floral', 'fruity'], impression: ['sophisticated', 'feminine'], strength: ['medium'] }
            },
            
            // Woody / Musk / Complex
            { 
                id: 'lazy_sunday', 
                brand: 'Maison Margiela', 
                name: 'Lazy Sunday Morning', 
                img: 'assets/images/MRG-LazySun-EDT.jpg',
                top: 'Pear', mid: 'Iris', base: 'White Musk',
                desc: 'æ—¥æ›œæ—¥ã®æœã€æ´—ã„ç«‹ã¦ã®ãƒªãƒãƒ³ã®ã‚·ãƒ¼ãƒ„ã«åŒ…ã¾ã‚Œã¦éã”ã™å¿ƒåœ°ã‚ˆã„æ™‚é–“ã€‚è‚Œã«é¦´æŸ“ã‚€æŸ”ã‚‰ã‹ã„ãƒ ã‚¹ã‚¯ã¯ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ãŸã„æ—¥ã«æœ€é©ã€‚',
                link: 'index.html#products',
                tags: { scene: ['relax', 'daily', 'date'], type: ['musk', 'clean'], impression: ['clean', 'sensual'], strength: ['light', 'medium'] }
            },
            { 
                id: 'another_13', 
                brand: 'LE LABO', 
                name: 'Another 13', 
                img: 'assets/images/LLB-Another13-EDP.jpg',
                top: 'Ambroxan', mid: 'Jasmine', base: 'Moss',
                desc: 'éƒ½ä¼šçš„ã§é‹­ãã€ãã‚Œã§ã„ã¦ä¸­æ¯’æ€§ã®ã‚ã‚‹ã‚¢ãƒ‹ãƒãƒªãƒƒã‚¯ãªãƒ ã‚¹ã‚¯ã€‚ä½“æ¸©ã¨æ··ã–ã‚Šåˆã†ã“ã¨ã§ã€Œã‚ãªãŸã ã‘ã®é¦™ã‚Šã€ã«å¤‰åŒ–ã™ã‚‹ã€å”¯ä¸€ç„¡äºŒã®å­˜åœ¨æ„Ÿã€‚',
                link: 'index.html#products',
                tags: { scene: ['daily', 'special', 'date'], type: ['musk', 'woody'], impression: ['unique', 'sophisticated', 'sensual'], strength: ['medium', 'unique'] }
            },
            { 
                id: 'orpheon', 
                brand: 'DIPTYQUE', 
                name: 'Orpheon', 
                img: 'assets/images/DPTY-Orpheon-EDP.jpg',
                top: 'Juniper Berry', mid: 'Jasmine', base: 'Powder',
                desc: '60å¹´ä»£ã®ãƒ‘ãƒªã®ãƒãƒ¼ã®é›°å›²æ°—ã‚’å†ç¾ã€‚ã‚¿ãƒã‚³ã®ç…™ã€ãƒ‘ã‚¦ãƒ€ãƒªãƒ¼ãªåŒ–ç²§ã€æœ¨ã®æ¸©ã‚‚ã‚Šã€‚çŸ¥çš„ã§ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹ãªå°è±¡ã‚’ä¸ãˆã‚‹é¦™ã‚Šã€‚',
                link: 'index.html#products',
                tags: { scene: ['night', 'bar', 'special'], type: ['woody', 'spicy'], impression: ['sophisticated', 'sensual', 'unique'], strength: ['medium', 'heavy'] }
            },
            { 
                id: 'jazz_club', 
                brand: 'Maison Margiela', 
                name: 'Jazz Club', 
                img: 'assets/images/MRG-JazzClub-EDT.jpg',
                top: 'Pink Pepper', mid: 'Rum', base: 'Tobacco',
                desc: 'ãƒ–ãƒ«ãƒƒã‚¯ãƒªãƒ³ã®ã‚¸ãƒ£ã‚ºã‚¯ãƒ©ãƒ–ã€‚ãƒ©ãƒ é…’ã®ç”˜ã•ã¨ã‚¿ãƒã‚³ã®è‘‰ã®ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ã•ãŒçµ¡ã¿åˆã†ã€å¤§äººã®ãŸã‚ã®ã‚»ã‚¯ã‚·ãƒ¼ã§ç”˜ç¾ãªé¦™ã‚Šã€‚',
                link: 'index.html#products',
                tags: { scene: ['date', 'special', 'night'], type: ['woody', 'sweet'], impression: ['sensual', 'unique'], strength: ['heavy', 'unique'] }
            },
            { 
                id: 'sauvage', 
                brand: 'DIOR', 
                name: 'Sauvage', 
                img: 'assets/images/DIO-Sauvage-EDT.jpg',
                top: 'Bergamot', mid: 'Pepper', base: 'Ambroxan',
                desc: 'åºƒå¤§ãªå¤§åœ°ã«ã‚¤ãƒ³ã‚¹ãƒ‘ã‚¤ã‚¢ã•ã‚ŒãŸã€é‡æ€§çš„ã§åŠ›å¼·ã„é¦™ã‚Šã€‚ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãªã‚·ãƒˆãƒ©ã‚¹ã¨ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼ãªã‚¦ãƒƒãƒ‡ã‚£ãŒã€è‡ªä¿¡ã¨æ´»åŠ›ã‚’ä¸ãˆã¦ãã‚Œã¾ã™ã€‚',
                link: 'index.html#products',
                tags: { scene: ['night', 'date', 'daily'], type: ['spicy', 'citrus'], impression: ['masculine', 'sophisticated'], strength: ['heavy', 'medium'] }
            }
        ];

        // --- Logic ---
        let userAnswers = {};
        const totalSteps = 4;

        function updateProgress(step) {
            const percentage = ((step - 1) / totalSteps) * 100;
            document.getElementById('progressBar').style.width = percentage + '%';
        }

        function nextStep(currentStepNum, key, value) {
            // Save Answer
            userAnswers[key] = value;

            // Animate Current Step Out
            const currentEl = document.getElementById('step' + currentStepNum);
            currentEl.style.opacity = '0';
            currentEl.style.transform = 'translateX(-20px)';
            
            setTimeout(() => {
                currentEl.style.display = 'none';
                
                // Animate Next Step In
                const nextStepNum = currentStepNum + 1;
                const nextEl = document.getElementById('step' + nextStepNum);
                
                if(nextEl) {
                    nextEl.style.display = 'block';
                    nextEl.style.opacity = '0';
                    nextEl.style.transform = 'translateX(20px)';
                    
                    updateProgress(nextStepNum);
                    
                    // Force Reflow
                    void nextEl.offsetWidth;
                    
                    nextEl.style.opacity = '1';
                    nextEl.style.transform = 'translateX(0)';
                }
            }, 300);
        }

        function finishQuiz(key, value) {
            userAnswers[key] = value;
            
            // Hide Step 4
            const step4 = document.getElementById('step4');
            step4.style.opacity = '0';
            setTimeout(() => {
                step4.style.display = 'none';
                showAnalyzing();
            }, 300);
        }

        function showAnalyzing() {
            const analyzingEl = document.getElementById('analyzingView');
            analyzingEl.style.display = 'block';
            updateProgress(5); // Full bar

            // Simulate AI Processing
            setTimeout(() => {
                analyzingEl.style.display = 'none';
                calculateAndShowResult();
            }, 1800);
        }

        function calculateAndShowResult() {
            // Scoring Logic
            const scores = products.map(product => {
                let score = 0;
                
                // 1. Scene Matching (Weight: 3)
                if (product.tags.scene.includes(userAnswers.scene)) score += 3;
                
                // 2. Type Matching (Weight: 4) - Most important
                // Allow partial match (e.g. citrus vs fresh) mapped roughly
                const typeMap = {
                    'citrus': ['citrus', 'fresh', 'clean'],
                    'floral': ['floral', 'fruity', 'sweet'],
                    'woody': ['woody', 'spicy', 'masculine'],
                    'musk': ['musk', 'clean', 'skin']
                };
                
                const targetTypes = typeMap[userAnswers.scent_type] || [];
                const hasTypeMatch = product.tags.type.some(t => targetTypes.includes(t));
                if (hasTypeMatch) score += 4;
                
                // 3. Impression Matching (Weight: 2)
                if (product.tags.impression.includes(userAnswers.impression)) score += 2;
                
                // 4. Strength Matching (Weight: 1)
                if (product.tags.strength.includes(userAnswers.strength)) score += 1;

                return { product, score };
            });

            // Sort by Score Descending
            scores.sort((a, b) => b.score - a.score);

            // Get Top 2
            const winner = scores[0].product;
            const runnerUp = scores[1].product;

            // Render Winner
            document.getElementById('resBrand').textContent = winner.brand;
            document.getElementById('resName').textContent = winner.name;
            document.getElementById('resImg').src = winner.img;
            document.getElementById('resTop').textContent = winner.top;
            document.getElementById('resMid').textContent = winner.mid;
            document.getElementById('resBase').textContent = winner.base;
            document.getElementById('resDesc').textContent = winner.desc;
            document.getElementById('resLink').href = winner.link;

            // Render Runner Up
            document.getElementById('secondRecommendation').onclick = () => { window.location.href = runnerUp.link; };
            document.getElementById('secImg').src = runnerUp.img;
            document.getElementById('secBrand').textContent = runnerUp.brand;
            document.getElementById('secName').textContent = runnerUp.name;

            // Show Result View
            const resView = document.getElementById('resultView');
            resView.style.display = 'block';
            
            setTimeout(() => {
                resView.style.opacity = '1';
            }, 50);
        }

        function restartQuiz() {
            const resView = document.getElementById('resultView');
            resView.style.opacity = '0';
            
            setTimeout(() => {
                resView.style.display = 'none';
                
                userAnswers = {};
                document.getElementById('step1').style.display = 'block';
                updateProgress(1);
                
                // Reset Animations
                const step1 = document.getElementById('step1');
                step1.style.opacity = '1';
                step1.style.transform = 'translateX(0)';
            }, 500);
        }
    </script>
</body>
</html>